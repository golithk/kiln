# =============================================================================
# Kiln Configuration
# =============================================================================
# This file uses KEY=value format. Lines starting with # are comments.
# See https://github.com/agentic-metallurgy/kiln for documentation.

# =============================================================================
# CRITICAL Settings - User Identity
# =============================================================================
# These settings control who can trigger workflows and enable team collaboration.

# Your GitHub username (required)
# SECURITY: Only you can trigger workflows by moving cards on the project board.
# Team members (if configured) can work alongside you without triggering warnings.
USERNAME_SELF=

# =============================================================================
# Team Collaboration (Optional)
# =============================================================================
# Enable multiple users to work on the same project board, each running their
# own kiln instance. Team members' actions are logged silently (DEBUG level),
# while unknown actors still produce warnings.

# Team member usernames (comma-separated, optional)
# These users can work alongside you without triggering warnings in your logs.
# Each team member should run their own kiln instance with their own USERNAME_SELF.
# Example: USERNAMES_TEAM=alice,bob,charlie
# USERNAMES_TEAM=

# =============================================================================
# Required Settings
# =============================================================================

# GitHub project board URLs to monitor (comma-separated)
# Example: https://github.com/orgs/your-org/projects/1 (views are optional)
PROJECT_URLS=

# =============================================================================
# GitHub Authentication
# =============================================================================
# Kiln automatically configures git to use gh CLI for HTTPS authentication.
# Git operations (clone, fetch, push) will use your GitHub token automatically.
# This modifies your global git config to set a credential helper for each
# hostname found in PROJECT_URLS.

# GitHub personal access token (optional)
# If not set, kiln uses credentials from `gh auth login`
# GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# =============================================================================
# GitHub Enterprise Server
# =============================================================================
# Configure these settings to use GitHub Enterprise Server instead of github.com.
#
# IMPORTANT: Kiln operates against EITHER github.com OR GitHub Enterprise Server,
# not both simultaneously. Setting both GITHUB_TOKEN and GITHUB_ENTERPRISE_TOKEN
# will result in a configuration error.

# GitHub Enterprise Server hostname (without protocol)
# Example: github.mycompany.com
# GITHUB_ENTERPRISE_HOST=

# GitHub Enterprise Server personal access token
# Requires a classic PAT with repo and project scopes (same as github.com)
# NOTE: This token is only used when GITHUB_ENTERPRISE_HOST is also set
# GITHUB_ENTERPRISE_TOKEN=

# GitHub Enterprise Server version (e.g., "3.14")
# Required for GHES installations to select the correct API client.
# Different GHES versions have different API capabilities - Kiln uses
# version-specific clients to handle these differences.
# Supported versions: 3.14, 3.15, 3.16, 3.17, 3.18, 3.19
# NOTE: Only set this when using GitHub Enterprise Server.
# GITHUB_ENTERPRISE_VERSION=3.14

# Mask GHES hostname and org name in logs (default: true)
# When enabled, logs show <GHES> and <ORG> instead of actual values.
# Set to false if you need full URLs in logs for debugging.
# GHES_LOGS_MASK=true

# =============================================================================
# Optional Settings
# =============================================================================

# Polling interval in seconds (default: 30)
# POLL_INTERVAL=30

# Maximum concurrent workflows (default: 3)
# MAX_CONCURRENT_WORKFLOWS=3

# Project board statuses to watch (comma-separated)
# Default: Research,Plan,Implement
# WATCHED_STATUSES=Research,Plan,Implement

# Log level: DEBUG, INFO, WARNING, ERROR (default: INFO)
# LOG_LEVEL=INFO

# Claude model overrides per workflow stage (JSON format)
# Default: {"Prepare": "haiku", "Research": "opus", "Plan": "opus", "Implement": "opus"}
# STAGE_MODELS={"Prepare": "haiku", "Research": "sonnet", "Plan": "opus", "Implement": "sonnet"}

# =============================================================================
# Safety Settings
# =============================================================================

# Maximum number of TASKs allowed to be appended during an active implementation run.
# Set to 0 for infinite (no limit). Recommended: 5 for production environments.
# Prevents runaway loops if implementation/user keeps adding new TASKs during execution.
# SAFETY_ALLOW_APPENDED_TASKS=0

# =============================================================================
# Telemetry
# =============================================================================

# OpenTelemetry endpoint for metrics (HTTP OTLP, port 4318)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Service name for telemetry (default: kiln)
# OTEL_SERVICE_NAME=kiln

# Enable Claude Code telemetry (0 or 1, default: 0)
# CLAUDE_CODE_ENABLE_TELEMETRY=0

# =============================================================================
# PagerDuty Notifications
# =============================================================================
# Get notified when kiln enters or exits hibernation mode due to GitHub API
# connectivity issues. Requires a PagerDuty Events API v2 integration key.
#
# To set up:
# 1. Create a new service in PagerDuty (or use an existing one)
# 2. Add an "Events API v2" integration to the service
# 3. Copy the "Integration Key" (32 character routing key)
#
# When configured:
# - Alert triggered when entering hibernation (connectivity lost)
# - Alert auto-resolved when exiting hibernation (connectivity restored)
# - Alerts include project URLs being monitored

# PagerDuty Events API v2 routing key (optional)
# PAGERDUTY_ROUTING_KEY=

# =============================================================================
# Slack Notifications
# =============================================================================
# Get notified via Slack DM when issues reach their final destination.
# Requires a Slack bot with chat:write scope.
#
# To set up:
# 1. Create a Slack app at https://api.slack.com/apps
# 2. Add the "chat:write" bot scope under OAuth & Permissions
# 3. Install the app to your workspace
# 4. Copy the "Bot User OAuth Token" (starts with xoxb-)
# 5. Find your Slack user ID (click your profile > ... > Copy member ID)
#
# Notifications are sent when:
# - Research completes (if issue was placed in Research)
# - Plan completes (if issue was placed in Plan)
# - Implementation moves to Validate (if issue was placed in Implement)
# - YOLO issues move to Validate (regardless of starting point)

# Slack Bot OAuth token (required for notifications)
# SLACK_BOT_TOKEN=xoxb-your-token-here

# Your Slack user ID (starts with U, e.g., U01234ABCDE)
# SLACK_USER_ID=

# =============================================================================
# MCP (Model Context Protocol) with Azure OAuth 2.0
# =============================================================================
# Configure Azure OAuth 2.0 ROPC (Resource Owner Password Credentials) flow
# to retrieve bearer tokens for MCP servers that require Azure Entra ID
# authentication. This enables Claude workflows to access operational tools
# like deployment systems, monitoring APIs, etc.
#
# IMPORTANT: All Azure OAuth fields must be set together or none at all.
# If partially configured, kiln will fail with a validation error.
#
# To set up:
# 1. Create an Azure AD application in your Azure portal
# 2. Create a service user account for ROPC authentication
# 3. Grant the service user appropriate permissions
# 4. Configure the fields below with your Azure credentials
# 5. Create .kiln/mcp.json with your MCP server definitions
#
# Note: AZURE_SCOPE is optional and defaults to "https://graph.microsoft.com/.default"

# Azure Entra ID tenant ID (directory ID from Azure portal)
# AZURE_TENANT_ID=

# Azure AD application (client) ID
# AZURE_CLIENT_ID=

# Service user username for ROPC flow (e.g., service-user@yourdomain.com)
# AZURE_USERNAME=

# Service user password for ROPC flow
# AZURE_PASSWORD=

# OAuth scope (optional, defaults to "https://graph.microsoft.com/.default")
# AZURE_SCOPE=https://graph.microsoft.com/.default

# MCP Server Configuration File
# =============================================================================
# Define MCP servers in .kiln/mcp.json. Use ${AZURE_BEARER_TOKEN} as a placeholder
# in any field where a bearer token is needed - Kiln will substitute it with
# a fresh token before passing to Claude.
#
# Example .kiln/mcp.json:
# {
#   "mcpServers": {
#     "deployment-api": {
#       "command": "npx",
#       "args": ["-y", "@company/mcp-deployment-server"],
#       "env": {
#         "DEPLOYMENT_API_TOKEN": "${AZURE_BEARER_TOKEN}"
#       }
#     }
#   }
# }
#
# See docs/user-guide.md for detailed MCP configuration documentation.
