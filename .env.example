# =============================================================================
# Kiln Configuration
# =============================================================================
# This file uses KEY=value format. Lines starting with # are comments.
# See https://github.com/agentic-metallurgy/kiln for documentation.

# =============================================================================
# CRITICAL Settings - User Identity
# =============================================================================
# These settings control who can trigger workflows and enable team collaboration.

# Your GitHub username (required)
# SECURITY: Only you can trigger workflows by moving cards on the project board.
# Team members (if configured) can work alongside you without triggering warnings.
USERNAME_SELF=

# =============================================================================
# Team Collaboration (Optional)
# =============================================================================
# Enable multiple users to work on the same project board, each running their
# own kiln instance. Team members' actions are logged silently (DEBUG level),
# while unknown actors still produce warnings.

# Team member usernames (comma-separated, optional)
# These users can work alongside you without triggering warnings in your logs.
# Each team member should run their own kiln instance with their own USERNAME_SELF.
# Example: USERNAMES_TEAM=alice,bob,charlie
# USERNAMES_TEAM=

# =============================================================================
# Required Settings
# =============================================================================

# GitHub project board URLs to monitor (comma-separated)
# Example: https://github.com/orgs/your-org/projects/1 (views are optional)
PROJECT_URLS=

# =============================================================================
# GitHub Authentication
# =============================================================================
# Kiln automatically configures git to use gh CLI for HTTPS authentication.
# Git operations (clone, fetch, push) will use your GitHub token automatically.
# This modifies your global git config to set a credential helper for each
# hostname found in PROJECT_URLS.

# GitHub personal access token (optional)
# If not set, kiln uses credentials from `gh auth login`
# GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# =============================================================================
# GitHub Enterprise Server
# =============================================================================
# Configure these settings to use GitHub Enterprise Server instead of github.com.
#
# IMPORTANT: Kiln operates against EITHER github.com OR GitHub Enterprise Server,
# not both simultaneously. Setting both GITHUB_TOKEN and GITHUB_ENTERPRISE_TOKEN
# will result in a configuration error.

# GitHub Enterprise Server hostname (without protocol)
# Example: github.mycompany.com
# GITHUB_ENTERPRISE_HOST=

# GitHub Enterprise Server personal access token
# Requires a classic PAT with repo and project scopes (same as github.com)
# NOTE: This token is only used when GITHUB_ENTERPRISE_HOST is also set
# GITHUB_ENTERPRISE_TOKEN=

# GitHub Enterprise Server version (e.g., "3.14")
# Required for GHES installations to select the correct API client.
# Different GHES versions have different API capabilities - Kiln uses
# version-specific clients to handle these differences.
# Supported versions: 3.14, 3.15, 3.16, 3.17, 3.18, 3.19
# NOTE: Only set this when using GitHub Enterprise Server.
# GITHUB_ENTERPRISE_VERSION=3.19

# Mask GHES hostname and org name in logs (default: true)
# When enabled, logs show <GHES> and <ORG> instead of actual values.
# Set to false if you need full URLs in logs for debugging.
# GHES_LOGS_MASK=true

# =============================================================================
# Optional Settings
# =============================================================================

# Polling interval in seconds (default: 30)
# POLL_INTERVAL=30

# Maximum concurrent workflows (default: 6)
# MAX_CONCURRENT_WORKFLOWS=6

# Project board statuses to watch (comma-separated)
# Default: Research,Plan,Implement
# WATCHED_STATUSES=Research,Plan,Implement

# Log level: DEBUG, INFO, WARNING, ERROR (default: INFO)
# LOG_LEVEL=INFO

# Log file path (default: .kiln/logs/kiln.log)
# LOG_FILE=.kiln/logs/kiln.log

# Claude model overrides per workflow stage (JSON format)
# Default: {"Prepare": "haiku", "Research": "opus", "Plan": "opus", "Implement": "opus"}
# STAGE_MODELS={"Prepare": "haiku", "Research": "sonnet", "Plan": "opus", "Implement": "sonnet"}

# =============================================================================
# Safety Settings
# =============================================================================

# Maximum number of TASKs allowed to be appended during an active implementation run.
# Set to 0 for infinite (no limit). Recommended: 5 for production environments.
# Prevents runaway loops if implementation/user keeps adding new TASKs during execution.
# SAFETY_ALLOW_APPENDED_TASKS=0

# =============================================================================
# Telemetry
# =============================================================================

# OpenTelemetry endpoint for metrics (HTTP OTLP, port 4318)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Service name for telemetry (default: kiln)
# OTEL_SERVICE_NAME=kiln

# Enable Claude Code telemetry (0 or 1, default: 0)
# CLAUDE_CODE_ENABLE_TELEMETRY=0

# =============================================================================
# Slack Notifications
# =============================================================================
# Get notified via Slack DM when issues reach their final destination.
# Requires a Slack bot with chat:write scope.
#
# To set up:
# 1. Create a Slack app at https://api.slack.com/apps
# 2. Add the "chat:write" bot scope under OAuth & Permissions
# 3. Install the app to your workspace
# 4. Copy the "Bot User OAuth Token" (starts with xoxb-)
# 5. Find your Slack user ID (click your profile > ... > Copy member ID)
#
# Notifications are sent when:
# - Research completes (if issue was placed in Research)
# - Plan completes (if issue was placed in Plan)
# - Implementation moves to Validate (if issue was placed in Implement)
# - YOLO issues move to Validate (regardless of starting point)

# Slack Bot OAuth token (required for notifications)
# SLACK_BOT_TOKEN=xoxb-your-token-here

# Your Slack user ID (starts with U, e.g., U01234ABCDE)
# SLACK_USER_ID=

# Send Slack DM when a user comment has been processed (default: 1 = enabled)
# Set to 0 to disable comment processing notifications
# SLACK_DM_ON_COMMENT=1

# =============================================================================
# MCP (Model Context Protocol) with Azure OAuth 2.0
# =============================================================================
# Configure Azure OAuth 2.0 ROPC (Resource Owner Password Credentials) flow
# to retrieve bearer tokens for MCP servers that require Azure Entra ID
# authentication. This enables Claude workflows to access operational tools
# like deployment systems, monitoring APIs, etc.
#
# IMPORTANT: All Azure OAuth fields must be set together or none at all.
# If partially configured, kiln will fail with a validation error.
#
# To set up:
# 1. Create an Azure AD application in your Azure portal
# 2. Create a service user account for ROPC authentication
# 3. Grant the service user appropriate permissions
# 4. Configure the fields below with your Azure credentials
# 5. Create .kiln/mcp.json with your MCP server definitions
#
# Note: AZURE_SCOPE is optional and defaults to "https://graph.microsoft.com/.default"

# Azure Entra ID tenant ID (directory ID from Azure portal)
# AZURE_TENANT_ID=

# Azure AD application (client) ID
# AZURE_CLIENT_ID=

# Service user username for ROPC flow (e.g., service-user@yourdomain.com)
# AZURE_USERNAME=

# Service user password for ROPC flow
# AZURE_PASSWORD=

# OAuth scope (optional, defaults to "https://graph.microsoft.com/.default")
# AZURE_SCOPE=https://graph.microsoft.com/.default

# MCP Server Configuration File
# =============================================================================
# Define MCP servers in .kiln/mcp.json. Use ${AZURE_BEARER_TOKEN} as a placeholder
# in any field where a bearer token is needed - Kiln will substitute it with
# a fresh token before passing to Claude.
#
# Example .kiln/mcp.json:
# {
#   "mcpServers": {
#     "deployment-api": {
#       "command": "npx",
#       "args": ["-y", "@company/mcp-deployment-server"],
#       "env": {
#         "DEPLOYMENT_API_TOKEN": "${AZURE_BEARER_TOKEN}"
#       }
#     }
#   }
# }
#
# See docs/user-guide.md for detailed MCP configuration documentation.

# =============================================================================
# Repository Credentials
# =============================================================================
# Map repositories to local credential files for integration testing.
# Create .kiln/credentials.yaml to automatically copy credential files
# (e.g., .env files) into worktrees before Claude workflows execute.
#
# This allows Claude to run commands like `docker compose up` with proper
# credentials without storing secrets in the repository.
#
# Example .kiln/credentials.yaml:
# repositories:
#   - title: "My API Service"
#     repo_url: "https://github.com/my-org/api-service"
#     credential_path: "/absolute/path/to/.env"
#     # destination: ".env"  # Optional, defaults to ".env" (root of worktree)
#
#   - title: "Frontend App"
#     repo_url: "ghes.example.com/my-org/frontend-app"
#     credential_path: "/absolute/path/to/frontend/.env.local"
#     destination: "docker/.env"  # Place in subdirectory within worktree
#
# Fields:
#   title: Human-readable label (for your reference)
#   repo_url: Repository URL â€” paste any format and kiln will extract host/owner/repo
#     Accepts: "https://github.com/org/repo", "github.com/org/repo",
#              "github.com/org/repo/tree/main", "ghes.example.com/org/repo", etc.
#   credential_path: Absolute path to the credential file on disk
#   destination: Where to place the file in the worktree (default: ".env")
#
# Matching logic:
#   Kiln parses repo_url into host/owner/repo and matches against the full
#   identifier (e.g., "github.com/my-org/api-service"). This means entries
#   for github.com and a GHES instance are always distinct, even if the
#   org and repo names are the same.
#
# If the credential file at credential_path doesn't exist, a warning is logged
# but the workflow continues without interruption.
